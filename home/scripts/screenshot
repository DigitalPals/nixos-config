#!/bin/bash
# Screenshot tool with Satty editor
# Usage: screenshot [region|fullscreen]

OUTPUT_DIR="$HOME/Pictures/Screenshots"
mkdir -p "$OUTPUT_DIR"

# Cancel any existing slurp
pkill slurp && exit 0

MODE="${1:-region}"

case "$MODE" in
  fullscreen)
    SELECTION=$(hyprctl monitors -j | jq -r '.[] | select(.focused == true) | "\(.x),\(.y) \((.width / .scale) | floor)x\((.height / .scale) | floor)"')
    ;;
  region|*)
    wayfreeze & PID=$!
    sleep 0.1
    SELECTION=$(slurp 2>/dev/null)
    kill $PID 2>/dev/null
    ;;
esac

[ -z "$SELECTION" ] && exit 0

grim -g "$SELECTION" - | \
  satty --filename - \
    --output-filename "$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png" \
    --early-exit \
    --save-after-copy \
    --copy-command 'wl-copy'
